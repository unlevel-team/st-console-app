
<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">

<link rel="import" href="../bower_components/paper-styles/color.html">
<link rel="import" href="../bower_components/paper-styles/default-theme.html">
<link rel="import" href="../bower_components/paper-styles/shadow.html">

<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">


<dom-module id="st-view-EngineOptions">

	<link rel="import" type="css" href="styles.css">

  <template>

    <style>
    
    </style>
    
    
<!--  Toast objects -->
    <paper-toast id="toast_Error" 
    	text="[[toast_ErrorMessage]]"></paper-toast>
	<paper-toast id="toast_OK" 
		text="[[toast_Message]]"></paper-toast>
    </div>



<!--  Engine options dialog -->
	<paper-dialog id="engineOptions_Dialog" role="dialog" tabindex="-1"
		aria-hidden="true" 
		class="x-scope paper-dialog-0"
		style="outline: none; display: none;">
	
	
	<h2>Engine settings</h2>
		<div class="card">
<!-- 		<form is="iron-form" id="engineOptions_Form"> -->
	
			<p><b>type:</b> {{selectedEngine.type}}</p>
			<p><b>ID:</b> {{selectedEngine.engine._sysID}}</p>
			<p><b>engine:</b> {{selectedEngine.engine.engine}}</p>
			
			
	
<!-- 			<paper-input name="netLocation" label="Net location" -->
<!-- 				placeholder="[[netLocation]]" value="[[netLocation]]" required -->
<!-- 				auto-validate></paper-input> -->
<!-- 		</form> -->
		</div>
	
	<p>Every engine has it's own options. Could be changed when the engine is not working</p>
	<paper-dialog-scrollable>
	<iron-collapse class="hiddenSection" name="engineOptions">
	
		<form is="iron-form" id="engineOptions_Form">
		
			<paper-input name="loopTime" 
				label="Net location"
				placeholder="[[selectedEngine.ngnoptions.loopTime]]" 
				value="[[selectedEngine.ngnoptions.loopTime]]" 
				required
				auto-validate></paper-input>
			
			<paper-input name="showDeltaTime" 
				label="Show delta time"
				placeholder="[[selectedEngine.ngnoptions.engineOptions.showDeltaTime]]" 
				value="[[selectedEngine.ngnoptions.engineOptions.showDeltaTime]]" 
				required
				auto-validate></paper-input>
				
			<paper-input name="showTime" 
				label="Show time"
				placeholder="[[selectedEngine.ngnoptions.engineOptions.showTime]]" 
				value="[[selectedEngine.ngnoptions.engineOptions.showTime]]" 
				required
				auto-validate></paper-input>
				
			<paper-input name="ticks" 
				label="Ticks"
				placeholder="[[selectedEngine.ngnoptions.engineOptions.ticks]]" 
				value="[[selectedEngine.ngnoptions.engineOptions.ticks]]" 
				required
				auto-validate></paper-input>
				
			
	
		</form>
	</iron-collapse>
	</paper-dialog-scrollable>
		
	<div class="card">
			<br>
			<paper-button raised role="button" tabindex="0" animated=""
				aria-disabled="false" elevation="0" class="x-scope paper-button-0"
				on-click="_getEngineOptions">
			Get options</paper-button>
			
			<br><br>
	</div>
		
	<div class="buttons">
		<paper-button role="button" tabindex="0" animated=""
			aria-disabled="false" elevation="0" class="x-scope paper-button-0">More
		Info...</paper-button>
		<paper-button dialog-dismiss="" role="button" tabindex="0" animated=""
			aria-disabled="false" elevation="0" class="x-scope paper-button-0">Decline</paper-button>
		<paper-button dialog-confirm="" autofocus="" role="button" tabindex="0"
			animated="" aria-disabled="false" elevation="0"
			class="x-scope paper-button-0">Accept</paper-button>
	</div>
	
	</paper-dialog> 
    
    
    

  </template>

	<script>
	
	
	Polymer({

		is: 'st-view-EngineOptions',

		sensors: {
			type : Array,
			notify: true
		},

		actuators: {
			type : Array,
			notify: true
		},

		toast_ErrorMessage: String,
		toast_Message: String,
		
//			selectedEngine : {
//				type : Object
//			},


		viewOptions: {
        	type: Object,
        	value: function() {
        		return {
        			'refView': {}
        		};
        	}
        },
	        


		properties: {
			
			selectedEngine: {
	          type: Object,
	          notify: true,
	          reflectToAttribute: true,
	          value: function() {
	            return {
	            	'type':'eee',
	            	'engineid':'eee',
	            	'engine': {},
	            	'ngnoptions': {}
	            };
	          }
	        }
	        
	    },
	    
	    
	    observers: [
	                
                  	'_engineChanged(selectedEngine)',
                  	'_engineChanged(selectedEngine.*)'
                ],
                
        _engineChanged: function(changeRecord) {
             console.log('path: ' + changeRecord.path);	// TODO REMOVE DEBUG LOG
       		console.log('value: ' + changeRecord.value);	// TODO REMOVE DEBUG LOG
        	console.log(changeRecord.value);	// TODO REMOVE DEBUG LOG
             
       	},
       	
       	
       	showModal: function(options) {
       		
			console.log("_showModal"); // TODO REMOVE DEBUG LOG
			
			if (options === undefined) {
				options = {};
			}
			
			var _view = this;
			var _viewOptions = _view.viewOptions;
			var _engineOptions_Dialog = _view.$.engineOptions_Dialog;
			var _engineOptions = Polymer.dom(_view.root).querySelector('iron-collapse.hiddenSection[name="engineOptions"]');

			
			var _selectedEngine = _view.get('selectedEngine');
			
			console.log(_viewOptions); // TODO REMOVE DEBUG LOG
			// console.log(_button.dataset); // TODO REMOVE DEBUG LOG
			// console.log(_view.selectedEngine); // TODO REMOVE DEBUG LOG
			
	        
	        // e.stopPropagation();
	        
			_view.async(function(){
				_engineOptions.fitInto = _viewOptions.refView;
				_engineOptions.hide();
				_engineOptions_Dialog.open();
			}, 167);
			
			_view.async(function(){
				// Notification required for binding to update!
		        _view.notifyPath('selectedEngine.type', _selectedEngine.type);
		        _view.notifyPath('selectedEngine.engine', _selectedEngine.engine);
			}, 267);
       		
       	},	// endOf showModal
       	
       	
       	
       	
		
		_getEngineOptions: function(e, detail) {
			
			console.log("_getEngineOptions"); // TODO REMOVE DEBUG LOG
			
			var _view = this;
			var _engineOptions_Dialog = _view.$.engineOptions_Dialog;
			var _selectedEngine = _view.get('selectedEngine');
			var _engine = _selectedEngine.engine;
			var _consoleApp = st_ConsoleApp.get_ConsoleApp();
			
			var _toast_Error = _view.$.toast_Error;
			var _toast_OK = _view.$.toast_OK;
			var _engineOptions = Polymer.dom(_view.root).querySelector('iron-collapse.hiddenSection[name="engineOptions"]');

			
			var _scs_Request = null;
			var _scs_RequestOptions = null;
			
			
			e.stopPropagation();
			

			switch (_selectedEngine.type) {
			
				case 'sensor':
					
					_scs_Request = st_ConsoleApp.engines.sensors.get_SensorOptions;
					_scs_RequestOptions = {
							"consoleApp" : _consoleApp,
							"sensorID": _selectedEngine.engine._sysID
						};
					
					
					
					break;
					
				case 'actuator':
					
					_scs_Request = st_ConsoleApp.engines.actuators.get_ActuatorOptions;
					_scs_RequestOptions = {
							"consoleApp" : _consoleApp,
							"actuatorID": _selectedEngine.engine._sysID
						};
					break;
					
				default:
					break;
			}
			
			if (_scs_Request === null) {
				return;
			}
			
			try {

				_scs_Request(_scs_RequestOptions)
						.then(function(data) {

							console.log("st-view-EngineOptions._getEngineOptions - then..."); // TODO REMOVE DEBUG LOG
							console.log(data); // TODO REMOVE DEBUG LOG
							
							_selectedEngine.ngnoptions =  data.options;
							
							_view.async(function(){
						        _view.notifyPath('selectedEngine.ngnoptions', _selectedEngine.ngnoptions);
							}, 267);

							switch (_selectedEngine.type) {
								case 'sensor':
									
									switch (_engine.engine) {
										case 'STSensor_Dummy01':
											_engineOptions.show();
											_engineOptions_Dialog.notifyResize();
											_engineOptions.notifyResize()
											_engineOptions_Dialog.refit();
											console.log('_engineOptions.show'); // TODO REMOVE DEBUG LOG
											break;

										default:
											break;
									}
									
									
									
									break;

								default:
									break;
							}
							
							
							// Show toast message
							_toast_OK.close();
							_view.toast_Message = "Engine options received...";
							_toast_OK.fitInto = _engineOptions_Dialog;
							_toast_OK.open();

						},
						function(error) {

							// Show toast message
							_toast_OK.close();
							_view.toast_ErrorMessage = "Cannot get Engine options";
							_toast_Error.fitInto = _engineOptions_Dialog;
							_toast_Error.open();

							console.log("st-view-EngineOptions._getEngineOptions - error..."); // TODO REMOVE DEBUG LOG
							console.log(error); // TODO REMOVE DEBUG LOG
						});

			} catch (e) {
				// TODO: handle exception
				console.log("Error in Engine options"); // TODO REMOVE DEBUG LOG
				console.log(e); // TODO REMOVE DEBUG LOG
			}
			
			
		},	// endOf _getEngineOptions
	    


	});
	
	
	
	</script>



</dom-module>
    